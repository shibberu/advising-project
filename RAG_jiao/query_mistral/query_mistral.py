import boto3
import json
import os
from dotenv import load_dotenv

load_dotenv('./.env')
AWS_ACCESS_KEY_ID = os.getenv('AWS_ACCESS_KEY_ID')
AWS_SECRET_ACCESS_KEY = os.getenv('AWS_SECRET_ACCESS_KEY')
bedrock_runtime = boto3.client(
    service_name='bedrock-runtime',
    region_name='us-east-1',
    aws_access_key_id=AWS_ACCESS_KEY_ID,
    aws_secret_access_key=AWS_SECRET_ACCESS_KEY,
)

context = ''''
[Document(page_content='Here is the csv that describes the required courses for civil engineering: b,Requirements for,CIVIL ENGINEERING,Unnamed: 2,Unnamed: 3,...Catalog Year 2023-2024,Unnamed: 5,\r\n0,Student Name:,Insert your name here,,Priority of this major:,,1st or 2nd,\r\n1,Course Requirements,,Course Title,Cr\nHr,Term courses were or\nwill be taken,Course\nGrade,whether required for second major\r\n2,HSSA Requirements,36 credits,,,,,\r\n3,   HSSA #1 - HUM H190,,First-Year Writing Seminar,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n4,   HSSA #2  ,,Humanities & Arts (H),4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n5,   HSSA #3  ,,Social Sciences (S),4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n6,   HSSA #4  ,,H or S or Language (L),4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n7,   HSSA #5  ,,H or S or L,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n8,   HSSA #6  ,,H or S or L,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n9,   HSSA #7  ,,H or S or L,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n10,   HSSA #8  ,,H or S (cannot be a language),4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n11,   HSSA #9 - ENGL H290,,Tech & Profiessional Communications,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n12,General Requirements,44 credits,,,,,\r\n13,   CHEM 111,,Chemistry I     (Lect@3 + Lab@1),4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n14,   CHEM 113,,Chemistry II    (Lect@3 + Lab@1),4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n15,   RHIT 100,,Foundations for Rose-Hulman Success,1 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n16,   MA 111,,Calculus I,5 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n17,   MA 112,,Calculus II,5 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n18,   MA 113,,Calculus III,5 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n19,   MA 221,,Matrix Algebra & Diff Equations I,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n20,   MA 222,,Matrix Algebra & Diff Equations II,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n21,   MA 223,,Engineering Statistics I,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n22,   PH 111,,Physics I,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n23,   PH 112,,Physics II,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n24,CE Requirements,90 credits,,,,,\r\n25,   CE 101,,Engineering Surveying I,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n26,   CE 111,,Geographic Information Systems,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n27,   CE 250,,Sustainable Civil Engineering Design,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n28,   CE 303,,Engineering Economy,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n29,   CE 310,,CE Numerial Methods,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n30,   CE 320,,CE Materials,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n31,   CE 321,,Structural Mechanics I,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n32,   CE 336,,Soil Mechanics,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n33,   CE 371,,Hydraulic Engineering,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n34,   CE 380,,Intro to Transportation Engineering,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n35,   CE 400,,Career Prep Seminar,0 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n36,   CE 431,,Structural Design in Steel I,3 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n37,   CE 432,,Structural Design in Concrete,3 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n38,   CE 441,,Construction Engineering,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n39,   CE 450,,CE Codes & Regulations,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n40,   CE 460,,Environmental Engineering,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n41,   CE 461,,Environmental Engineering Lab,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n42,   CE 471,,Water Resources Engineering,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n43,   CE 486,,CE Design & Synthesis I,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n44,   CE 487x,,Technical System Design & Synthesis,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n45,   CE 488,,CE Design & Synthesis II,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n46,   CE 489,,CE Design & Synthesis III,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n47,   CE _________,,CE Elective #1 - CE400 or 500 Level,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n48,   CE _________,,CE Elective #2 - CE400 or 500 Level,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n49,   EM 102,,Graphical Comm for Civil Engr,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n50,   EM 103,,Intro to Design,2 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n51,   EM 120,,Engineering Statics,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n52,   EM 202,,Dynamics,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n53,   EM 203,,Mechanics of Materials,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n54,   EM 301,,Fluid Mechanics,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n55, Two of the following,,CE205, CHE 201, CHE202 or \nboth ES213 and ES213L,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n56,   four courses: ,,,4 credits,,,\r\n57,Electives,16 credits,,,,,\r\n58,,,Science Elective,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n59,,,Science Elect  (Excluding CHEM,PH),4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n60,,,Technical Elective,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n61,,,Technical Elective,4 credits,,,required for first major in civil engineering; no information is provided about whether this course is required for second major in civil engineering\r\n62,,186 credits, - CE Total Credit Hours Required -,194 credits,,,\r\n', metadata={'seq_num': 9, 'source': '/home/jiaoq/rag_proj/data/dataset_courseCtlgProcessed.txt', 'src': 'CIVIL_ENGINEERING.csv'}), 2.326833]

[Document(page_content='This information is for first major only, not for second major. Recommended schedule for civil engineering first major in junior year fall, or year 3. Recommended courses for a junior civil engineering student in fall, or a year 3 student.  CE 321 Structural Mechanics I 4 CE 336 Soil Mechanics 4 CE 205 Thermodynamics or CHE 201 Conservation Principles & Balances 4 CE 371 Hydraulic Engineering 4 Total Credits 16 ', metadata={'seq_num': 102, 'source': '/home/jiaoq/rag_proj/data/dataset_courseCtlgProcessed.txt', 'src': 'CivilEngineeringCourseCatalog'}), 0.168659]

[Document(page_content='CE 320 - Civil Engineering Materials\nCredit Hours:4 Term Available: Spring \nGraduate Studies Eligible: No\nPrerequisites: None\nCorequisites: None\nA study of the origin, nature, performance and selection criteria of various basic materials used in the practice of civil engineering. These include aggregates, portland cement, concrete, and bituminous materials. Emphasis will be placed on standard methods of testing and characterization as related to the mechanical behavior of materials.', metadata={'seq_num': 953, 'source': '/home/jiaoq/rag_proj/data/dataset_courseCtlgProcessed.txt', 'src': 'https://www.rose-hulman.edu/academics/course-catalog/current/programs/Civil%20Engineering/ce-320.html'}), -2.8055732]

[Document(page_content='Here is the csv that describes the required courses for mechanical engineering: b,Requirements for,MECHANICAL ENGINEERING,Unnamed: 2,Unnamed: 3,...Catalog Year 2023-2024,Unnamed: 5,whether required for second major,NOTE about Elective course requirements:  When completing a double major or two degree plan of study, it is not necessary to be specific on any Electives unless the class to be taken to fill an elective is required for one of the majors.  This will allow you more flexibility in scheduling and avoid the need to later file a revised plan of study.  If a specific course is listed to fulfill an elective, that specific course must then be taken.\r\n0,Student Name:,Insert your name here,,Priority of this major:,,1st or 2nd,,\r\n1,Course Requirements,,Course Title,Cr\nHr,Term courses were or\nwill be taken,Course\nGrade,,\r\n2,HSSA Requirements,36 credits,,,,,,\r\n3,   HSSA #1 - HUM H190,,First-Year Writing Seminar,4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n4,   HSSA #2  ,,Humanities & Arts (H),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n5,   HSSA #3  ,,Social Sciences (S),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n6,   HSSA #4  ,,H or S or Language (L),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n7,   HSSA #5  ,,H or S or L,4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n8,   HSSA #6  ,,H or S or L,4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n9,   HSSA #7  ,,H or S or L,4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n10,   HSSA #8  ,,H or S (cannot be a language),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n11,   HSSA #9 - ENGL H290,,Tech & Profiessional Communications,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,Must take RH330 (prereq for other required classes)\r\n12,General Requirements,44 credits,,,,,,\r\n13,   RHIT 100,,Foundations for Rose-Hulman Success,1 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n14,   BIO 101,,Essential Biology,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n15,   CHEM 111,,Chemistry I   (Lect @ 3, Lab @ 1),4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n16,   MA 111,,Calculus I,5 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n17,   MA 112,,Calculus II,5 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n18,   MA 113,,Calculus III,5 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n19,   MA 221,,Matrix Algebra& Diff Equations I,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n20,   MA 222,,Matrix Algebra& Diff Equations II,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n21,   MA 223,,Engineering Statistics I,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n22,   PH 111,,Physics I,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n23,   PH 112,,Physics II,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n24,ME Requirements,86 credits,,,,,,\r\n25,   EM 103,,Intro to Design,2 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n26,   EM 104,,Graphical Communications,2 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n27,   EM 121,,Statics & Mechanics of Materials I,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n28,   EM 204,,Statics & Mechanics of Materials II,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n29,   ES 201,,Cons & Accounting Principles,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n30,   ES 205,,Analysis & Design of Engr Systems,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n31,   ES 212,,Fluid Systems,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n32,   ES 213 & ES213L,,Electrical Systems (Lec @3, Lab @1),4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n33,   ES 214,,Mechanical Systems,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n34,   ME 123,,Computer Applications I,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n35,   ME 301,,Applications of Thermodynamics,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n36,   ME 302,,Heat Transfer,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n37,   ME 317,,Design for Manufacturing,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n38,   ME 321,,Mechanical Measurements,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n39,   ME 327,,Numerical Methods,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n40,   ME 328,,Material Engineering,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n41,   ME 406/EM406,,Control Syst or Vibration Analysis,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n42,   ME 421,,M.E. Lab,2 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n43,   ME 430,,Mechatronic Systems,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n44,   ME 470,,Capstone Design I,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,If ME is the 2nd major, ME470, ME471, and ME472 are typically substituted\nby the capstone sequence of the 1st major.  If the 1st major is in a math or science program, the ME Capstone Design sequence will be required.\r\n45,   ME 471,,Capstone Design II,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n46,   ME 472,,Capstone Design III,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n47,   ME 480,,Machine Component Design,4 credits,,,required for first major in mechanical engieering; required for second major in mechanical engineering,\r\n48,Electives,28 credits,,,,,,\r\n49,,,Math (200+) or Science Elective,4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n50,,,Technical Elective  (200-level +),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n51,,,Technical Elective  (200-level +),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n52,,,Technical Elective  (200-level +),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n53,,,Technical Elective  (200-level +),4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n54,,,Free Elective,4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n55,,,Free Elective,4 credits,,,required for first major in mechanical engineering; not required for second major in mechanical engineering,\r\n56,,194 credits, - ME Total Credit Hours Required -,194 credits,,,,\r\n', metadata={'source': '/home/jiaoq/rag_proj/data/dataset_courseCtlgProcessed.txt', 'seq_num': 20, 'src': 'MECHANICAL_ENGINEERING.csv'}), -5.459458]
'''

question = "What are the required courses if I major in civil engineering?"

def stream_response(prompt, max_tokens):
    body = json.dumps({
        'prompt': prompt,
        'max_tokens': max_tokens,
    })
       
    response = bedrock_runtime.invoke_model_with_response_stream(
        modelId='mistral.mistral-7b-instruct-v0:2', 
        body=body
    )
    
    stream = response.get('body')
    response = ''
    if stream:
        for event in stream:
            chunk = event.get('chunk')
            if chunk:
                token = json.loads(chunk.get('bytes').decode())['outputs'][0]['text']
                response += token
                #yield token
    print(response)

if __name__ == '__main__':
    
  
  res = stream_response(f" You are a helpful academic advisor. Given the following Context, please answer the question. If the context does not contain enough information to answer the question, do not answer. Context: \
    ---- \
    {context} \
    ---- \
    Answer the question: {question}\
  ", 224)

  print(res)

        